<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Detection Dashboard</title>
    <style>
        /* CSS Styles */
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #f9fafb;
            --sidebar-width: 250px;
            --sidebar-collapsed-width: 60px;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            display: flex;
            min-height: 100vh;
            background-color: #f3f4f6;
            color: #111827;
            overflow-x: hidden;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            transition: width var(--transition-speed);
            height: 100vh;
            position: fixed;
            overflow-y: auto;
            z-index: 100;
        }

        .left-sidebar {
            left: 0;
        }

        .right-sidebar {
            right: 0;
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }

        .sidebar-header {
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e5e7eb;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin: 0.5rem 0;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            text-decoration: none;
            color: #374151;
            border-radius: 0.375rem;
            margin: 0 0.5rem;
            transition: all 0.2s;
        }

        .sidebar-menu a:hover {
            background-color: #eef2ff;
            color: var(--primary-color);
        }

        .sidebar-menu a.active {
            background-color: #eef2ff;
            color: var(--primary-color);
            font-weight: 500;
        }

        .sidebar-menu .icon {
            margin-right: 0.75rem;
            font-size: 1.25rem;
            min-width: 24px;
            text-align: center;
        }

        .sidebar-menu .text {
            white-space: nowrap;
            transition: opacity var(--transition-speed);
        }

        .sidebar.collapsed .text {
            opacity: 0;
            width: 0;
        }

        .toggle-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #6b7280;
            font-size: 1.25rem;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            margin-right: var(--sidebar-width);
            padding: 2rem;
            transition: margin var(--transition-speed);
            min-height: 100vh;
        }

        .sidebar.collapsed + .main-content {
            margin-left: var(--sidebar-collapsed-width);
            margin-right: var(--sidebar-collapsed-width);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .dashboard-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #111827;
        }

        .video-container {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .video-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .video-input {
            flex: 1;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #4338ca;
        }

        .btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background-color: #d1d5db;
        }

        .video-player {
            width: 100%;
            aspect-ratio: 16/9;
            background-color: #000;
            border-radius: 0.375rem;
            overflow: hidden;
        }

        .webcam-container {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .webcam-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .webcam-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
        }

        .webcam-feed {
            width: 100%;
            aspect-ratio: 4/3;
            background-color: #000;
            border-radius: 0.375rem;
            overflow: hidden;
            position: relative;
        }

        .emotion-display {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 1rem;
        }

        /* Chatbox Styles */
        .chatbox {
            position: fixed;
            bottom: 2rem;
            right: calc(var(--sidebar-width) + 2rem);
            width: 350px;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            transition: all var(--transition-speed);
            z-index: 90;
        }

        .sidebar.collapsed + .main-content .chatbox {
            right: calc(var(--sidebar-collapsed-width) + 2rem);
        }

        .chatbox.closed {
            transform: translateY(calc(100% - 40px));
        }

        .chatbox-header {
            padding: 1rem;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .chatbox-title {
            font-weight: 600;
        }

        .chatbox-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
        }

        .chatbox-body {
            height: 300px;
            overflow-y: auto;
            padding: 1rem;
            background-color: var(--secondary-color);
        }

        .message {
            margin-bottom: 1rem;
            max-width: 80%;
        }

        .user-message {
            margin-left: auto;
            background-color: var(--primary-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 1rem 1rem 0 1rem;
        }

        .bot-message {
            margin-right: auto;
            background-color: white;
            color: #111827;
            padding: 0.5rem 1rem;
            border-radius: 1rem 1rem 1rem 0;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .chatbox-input {
            display: flex;
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
        }

        .chatbox-input input {
            flex: 1;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1rem;
            margin-right: 0.5rem;
        }

        .chatbox-input button {
            padding: 0.5rem 1rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0.375rem;
            cursor: pointer;
        }

        /* Mouse Tracking Indicator */
        .mouse-tracking {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            z-index: 100;
        }

        /* Responsive Styles */
        @media (max-width: 1024px) {
            .sidebar {
                width: var(--sidebar-collapsed-width);
            }
            .sidebar .text {
                opacity: 0;
                width: 0;
            }
            .main-content {
                margin-left: var(--sidebar-collapsed-width);
                margin-right: var(--sidebar-collapsed-width);
            }
            .chatbox {
                right: calc(var(--sidebar-collapsed-width) + 2rem);
            }
        }

        @media (max-width: 768px) {
            .right-sidebar {
                transform: translateX(100%);
            }
            .right-sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-right: 0;
            }
            .chatbox {
                right: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Left Sidebar -->
    <aside class="sidebar left-sidebar">
        <div class="sidebar-header">
            <span class="text">Emotion Dashboard</span>
            <button class="toggle-btn" id="leftToggle">≡</button>
        </div>
        <ul class="sidebar-menu">
            <li>
                <a href="#" class="active">
                    <span class="icon">📊</span>
                    <span class="text">Dashboard</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <span class="icon">🎭</span>
                    <span class="text">Emotion Stats</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <span class="icon">⚙️</span>
                    <span class="text">Settings</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Emotion Detection Dashboard</h1>
        </div>

        <!-- Video Player Section -->
        <div class="video-container">
            <div class="video-controls">
                <input type="text" class="video-input" id="videoUrl" placeholder="Paste YouTube URL here...">
                <button class="btn btn-primary" id="playVideo">Play Video</button>
            </div>
            <div class="video-player" id="videoPlayer">
                <!-- YouTube iframe will be inserted here -->
            </div>
        </div>

        <!-- Webcam Section -->
        <div class="webcam-container">
            <div class="webcam-header">
                <h2 class="webcam-title">Emotion Detection</h2>
                <button class="btn btn-primary" id="startWebcam">Start Webcam</button>
            </div>
            <div class="webcam-feed">
                <video id="webcamVideo" autoplay playsinline></video>
                <div class="emotion-display" id="emotionDisplay">Emotion: Neutral</div>
            </div>
        </div>

        <!-- Mouse Tracking Indicator -->
        <div class="mouse-tracking" id="mouseTracking">
            Mouse: X: 0, Y: 0
        </div>
    </main>

    <!-- Right Sidebar -->
    <aside class="sidebar right-sidebar">
        <div class="sidebar-header">
            <span class="text">Tools</span>
            <button class="toggle-btn" id="rightToggle">≡</button>
        </div>
        <ul class="sidebar-menu">
            <li>
                <a href="#" id="toggleChatbox">
                    <span class="icon">💬</span>
                    <span class="text">Chatbot</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <span class="icon">📈</span>
                    <span class="text">Analytics</span>
                </a>
            </li>
            <li>
                <a href="#">
                    <span class="icon">🔔</span>
                    <span class="text">Notifications</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- Chatbox -->
    <div class="chatbox closed" id="chatbox">
        <div class="chatbox-header" id="chatboxToggle">
            <h3 class="chatbox-title">Emotion Assistant</h3>
            <button class="chatbox-toggle">▼</button>
        </div>
        <div class="chatbox-body" id="chatMessages">
            <div class="message bot-message">
                Hello! I'm your emotion assistant. How can I help you today?
            </div>
        </div>
        <div class="chatbox-input">
            <input type="text" id="chatInput" placeholder="Type your message...">
            <button id="sendMessage">Send</button>
        </div>
    </div>

    <script>
        // JavaScript for the dashboard functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Sidebar toggle functionality
            const leftToggle = document.getElementById('leftToggle');
            const rightToggle = document.getElementById('rightToggle');
            const leftSidebar = document.querySelector('.left-sidebar');
            const rightSidebar = document.querySelector('.right-sidebar');
            
            leftToggle.addEventListener('click', function() {
                leftSidebar.classList.toggle('collapsed');
            });
            
            rightToggle.addEventListener('click', function() {
                rightSidebar.classList.toggle('collapsed');
            });

            // Chatbox toggle functionality
            const chatbox = document.getElementById('chatbox');
            const chatboxToggle = document.getElementById('chatboxToggle');
            const toggleChatboxBtn = document.getElementById('toggleChatbox');
            
            chatboxToggle.addEventListener('click', function() {
                chatbox.classList.toggle('closed');
            });
            
            toggleChatboxBtn.addEventListener('click', function(e) {
                e.preventDefault();
                chatbox.classList.remove('closed');
            });

            // Chat functionality
            const chatInput = document.getElementById('chatInput');
            const sendMessageBtn = document.getElementById('sendMessage');
            const chatMessages = document.getElementById('chatMessages');
            
            function addMessage(text, isUser) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message');
                messageDiv.classList.add(isUser ? 'user-message' : 'bot-message');
                messageDiv.textContent = text;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            sendMessageBtn.addEventListener('click', function() {
                const message = chatInput.value.trim();
                if (message) {
                    addMessage(message, true);
                    chatInput.value = '';
                    
                    // Simulate bot response
                    setTimeout(() => {
                        const responses = [
                            "I see you're interested in emotion detection. Would you like me to analyze your current emotional state?",
                            "Based on your mouse movements, you seem engaged with the content.",
                            "I can provide suggestions based on your emotional responses to the video.",
                            "Would you like to learn more about how emotion detection works?"
                        ];
                        const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                        addMessage(randomResponse, false);
                    }, 1000);
                }
            });
            
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessageBtn.click();
                }
            });

            // YouTube video player functionality
            const playVideoBtn = document.getElementById('playVideo');
            const videoUrlInput = document.getElementById('videoUrl');
            const videoPlayer = document.getElementById('videoPlayer');
            
            playVideoBtn.addEventListener('click', function() {
                const url = videoUrlInput.value.trim();
                if (url) {
                    let videoId = '';
                    
                    // Extract video ID from URL
                    if (url.includes('youtube.com/watch?v=')) {
                        videoId = url.split('v=')[1].split('&')[0];
                    } else if (url.includes('youtu.be/')) {
                        videoId = url.split('youtu.be/')[1].split('?')[0];
                    }
                    
                    if (videoId) {
                        videoPlayer.innerHTML = `
                            <iframe 
                                width="100%" 
                                height="100%" 
                                src="https://www.youtube.com/embed/${videoId}?autoplay=1" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen>
                            </iframe>
                        `;
                    } else {
                        alert('Please enter a valid YouTube URL');
                    }
                }
            });

            // Webcam and emotion detection functionality
            const startWebcamBtn = document.getElementById('startWebcam');
            const webcamVideo = document.getElementById('webcamVideo');
            const emotionDisplay = document.getElementById('emotionDisplay');
            
            startWebcamBtn.addEventListener('click', async function() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    webcamVideo.srcObject = stream;
                    startWebcamBtn.textContent = 'Webcam Active';
                    startWebcamBtn.classList.remove('btn-primary');
                    startWebcamBtn.classList.add('btn-secondary');
                    
                    // Simulate emotion detection (in a real app, this would connect to a Python backend)
                    const emotions = ['Happy', 'Sad', 'Angry', 'Surprised', 'Neutral', 'Disgusted', 'Fearful'];
                    setInterval(() => {
                        const randomEmotion = emotions[Math.floor(Math.random() * emotions.length)];
                        emotionDisplay.textContent = `Emotion: ${randomEmotion}`;
                        
                        // Update chatbox with emotion info
                        if (Math.random() > 0.8) { // 20% chance to comment on emotion
                            const comments = [
                                `I notice you look ${randomEmotion.toLowerCase()}. Is everything okay?`,
                                `You seem ${randomEmotion.toLowerCase()}. Would you like to talk about it?`,
                                `Your facial expression suggests you're feeling ${randomEmotion.toLowerCase()}.`
                            ];
                            const randomComment = comments[Math.floor(Math.random() * comments.length)];
                            addMessage(randomComment, false);
                        }
                    }, 3000);
                } catch (err) {
                    console.error('Error accessing webcam:', err);
                    alert('Could not access webcam. Please ensure you have granted permission.');
                }
            });

            // Mouse tracking functionality
            const mouseTracking = document.getElementById('mouseTracking');
            let mousePositions = [];
            
            document.addEventListener('mousemove', function(e) {
                mouseTracking.textContent = `Mouse: X: ${e.clientX}, Y: ${e.clientY}`;
                
                // Store mouse positions (in a real app, this would be sent to the backend)
                mousePositions.push({ x: e.clientX, y: e.clientY, timestamp: Date.now() });
                
                // Keep only the last 100 positions
                if (mousePositions.length > 100) {
                    mousePositions = mousePositions.slice(-100);
                }
                
                // Analyze movement patterns occasionally
                if (Math.random() > 0.95 && mousePositions.length > 10) {
                    const recentMovements = mousePositions.slice(-10);
                    const totalDistance = recentMovements.reduce((acc, curr, idx, arr) => {
                        if (idx === 0) return acc;
                        const prev = arr[idx - 1];
                        const dx = curr.x - prev.x;
                        const dy = curr.y - prev.y;
                        return acc + Math.sqrt(dx*dx + dy*dy);
                    }, 0);
                    
                    if (totalDistance > 500) {
                        addMessage("I notice you're moving your mouse rapidly. Are you finding the content engaging?", false);
                    } else if (totalDistance < 50) {
                        addMessage("You haven't moved your mouse much recently. Are you still paying attention?", false);
                    }
                }
            });

            // Simulate connection to backend (in a real app, this would use WebSocket or fetch)
            setInterval(() => {
                // This would be where you send data to the backend
                // and receive updates on emotion detection, etc.
            }, 5000);
        });
    </script>
</body>
</html>
